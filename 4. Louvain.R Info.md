**Louvain Clustering**

Louvain clustering is a graph-based algorithm which clusters **nodes** into tightly-packed clusters called **communities**.
It does this via a repetitive iteration of modularity optimisation, followed by community aggregation, until it has
achieved _**maximum modularity**_. Modularity is a measure of _how much more / less intra-community connectivity exists 
compared to a random network_. It is denoted by Q, and Q ranges between **-0.5 < Q < 1**.

In this code, we will be using a Louvain clustering algorithm which assigns a weight to each correlation (as opposed
to simply assigning an edge). This is because, should there be a correlation between 2 patients, a weighted edge
will quantify the strength of this correlation, which will be useful in clustering the nodes into more statistically
meaningful communities. 


**How can we assign a weight to an edge?**

There are various methods we can use to assign a weight to an edge. We will use the Pearson Correlation Coefficienct (PCC)
because the gene expression data is standardised (between -1 and 1) by taking the natural logarithm of the 
aboluste gene expression values. The coefficient can serve as the weight of the edge, with a minimum value being set to determine whether an edge should even exist between the 2 nodes. We will be altering this minimum value. 

**Resolution parameter (γ)**

γ scales the Expected no. of edges ↑ or ↓. We normally take it to be 1, but it can be raised or lowered. 
- **Raising γ (> 1)**: This makes it harder for 2 nodes in the same community to have an edge weight above expectation, so we end up with a larger number of small communities.
- **Lowering γ (< 1)**: Makes it easier for 2 nodes in the same community to have an edge weight above expectation, so we end up with a smaller number of large communities.

We will also be altering the value of γ.

**Varying γ and PCC**

We will be using various thresholds for the PCC. For the Resolution parameter, we will be using values of **0 - 1, with increments of 0.25**. We will not be increasing γ above 1 since at these values for γ, the modularity of the Louvain cluster falls to 0 and the number of communities becomes 500 (the number of patients). So it offers no valuable insights. 


**Finding the optimal parameters to perform Louvain Clustering**

We need to first determine the optimum correlation threshold and resolution limit. To do this, I have split up the 
clinical data into 2 groups: a train set and a testing set, in an 80 - 20 split. Louvain clustering is then performed for
each patient in the train set (based on their gene expression data of course) for each combination of PCC and γ. To determine
which combination is best, I used 2 metrics:

- **Percentage of nodes in designated communities**: We want our Louvain cluster to produce large communities.
  Therefore, any single-node communities have been removed. 
  This is because, since we are hoping for aetiology-based clusters and the 2 largest cluster sizes in the clinically labelled
  dataset are Viral (109 / 362 patients) and None (230 / 362 patients), the 2 largest communities in our
  optimum Louvain cluster must reflect this.
  
- **Weighted purity in the 2 largest communities**: Ideally, we'd like all the nodes within each of the 2 largest communities
  to be identical to one another i.e. high purity. For each community, the purity is the fraction of nodes that belong to the 
  largest clinical label (if a community has 100 nodes and 80 of them are labeled “None,” the purity is 80%).

  We want to also ensure that we adjust for size (for example, if Community A has 200 nodes and has a purity of 85%,
  whilst community B has a purity of 90% but a size of 100 nodes, then the increased size of A should be considered when
  calculating the overall purity).

  So, we develop the following formula for WP: **[ (Size_A × Purity_A) + (Size_B × Purity_B) ] / Size_A + Size_B**

  The following graph is then obtained:
​

